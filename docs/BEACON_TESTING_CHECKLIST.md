# Beacon Manager 測試清單

## 📋 測試前準備

### 1. 資料庫設定
- [ ] 在 Supabase SQL Editor 執行 `database/beacon_messages_actions_schema.sql`
- [ ] 確認 `beacon_messages` 表已建立
- [ ] 確認 `beacon_actions` 表已更新（新增欄位）
- [ ] 確認 `beacon_events` 表已更新（新增 is_friend 欄位）
- [ ] 確認範例推送訊息已插入（3筆）

### 2. 部署確認
- [ ] 程式碼已推送到 GitHub
- [ ] Netlify 已自動部署完成
- [ ] 檢查部署日誌無錯誤

## 🧪 功能測試

### A. 頁面載入測試
- [ ] 訪問 `/admin/beacon-manager.html`
- [ ] 確認需要登入（未登入會跳轉）
- [ ] 登入後成功進入管理頁面
- [ ] 確認統計儀表板顯示（4個統計卡片）
- [ ] 確認 3 個 Tab 按鈕顯示正常

### B. 統計儀表板測試
- [ ] **總設備數** 顯示正確數字
- [ ] **今日觸發次數** 顯示正確數字
- [ ] **已加入好友推送** 顯示正確數字
- [ ] **未加入好友推送** 顯示正確數字
- [ ] 等待 30 秒，確認統計自動刷新

### C. 設備管理測試（📡 設備管理 Tab）

#### C1. 新增設備
- [ ] 點擊「➕ 新增設備」按鈕
- [ ] Modal 彈出正常
- [ ] 填寫表單：
  - 設備名稱：測試設備 A
  - HWID：0123456789（10位16進制）
  - Vendor Key：12345678（選填）
  - Lot Key：1234567890abcdef（選填）
  - 位置：測試位置
  - 說明：這是測試設備
  - 啟用：勾選
- [ ] 點擊「💾 儲存」
- [ ] 確認顯示「✅ 設備已新增！」
- [ ] Modal 自動關閉
- [ ] 設備列表自動刷新，顯示新設備

#### C2. 設備列表顯示
- [ ] 設備卡片顯示正常
- [ ] 設備名稱顯示正確
- [ ] HWID 顯示正確（cyan 色）
- [ ] Vendor Key 顯示正確（如有填寫）
- [ ] 位置顯示正確
- [ ] 說明顯示正確
- [ ] 狀態標籤顯示「✅ 啟用中」

#### C3. 表單驗證
- [ ] HWID 欄位只接受 10 位 16 進制字元
- [ ] 必填欄位未填寫時無法提交
- [ ] 點擊「✕ 取消」可關閉 Modal

### D. 推送訊息測試（💬 推送訊息 Tab）

#### D1. 切換到推送訊息 Tab
- [ ] 點擊「💬 推送訊息」Tab
- [ ] Tab 按鈕變為 active 狀態（cyan 色）
- [ ] 內容區域切換正確
- [ ] 顯示範例訊息（3筆）

#### D2. 新增推送訊息
- [ ] 點擊「➕ 新增模板」按鈕
- [ ] Modal 彈出正常
- [ ] 填寫表單：
  - 模板名稱：測試訊息 A
  - 訊息類型：純文字訊息
  - 訊息內容：這是測試訊息內容
  - 目標對象：所有用戶
  - 說明：測試用
  - 啟用：勾選
- [ ] 點擊「💾 儲存」
- [ ] 確認顯示「✅ 推送訊息模板已新增！」
- [ ] Modal 自動關閉
- [ ] 訊息列表自動刷新

#### D3. 訊息列表顯示
- [ ] 訊息卡片顯示正常
- [ ] 模板名稱顯示正確
- [ ] 訊息類型顯示正確（📝 純文字）
- [ ] 目標對象顯示正確（👥 所有用戶）
- [ ] 訊息內容預覽顯示（前200字）
- [ ] 狀態標籤顯示「✅ 啟用中」

#### D4. 測試不同訊息類型
- [ ] 新增 Flex Message 類型訊息
- [ ] 新增圖片訊息類型
- [ ] 測試不同目標對象（已加入好友、未加入好友）

### E. 觸發動作測試（⚡ 觸發動作 Tab）

#### E1. 切換到觸發動作 Tab
- [ ] 點擊「⚡ 觸發動作」Tab
- [ ] Tab 按鈕變為 active 狀態
- [ ] 內容區域切換正確

#### E2. 新增觸發動作
- [ ] 點擊「➕ 新增動作」按鈕
- [ ] Modal 彈出正常
- [ ] 確認「選擇設備」下拉選單有選項（之前新增的設備）
- [ ] 確認「選擇推送訊息」下拉選單有選項（之前新增的訊息）
- [ ] 填寫表單：
  - 動作名稱：測試動作 A
  - 選擇設備：測試設備 A
  - 觸發類型：進入範圍 (Enter)
  - 選擇推送訊息：測試訊息 A
  - 說明：測試用觸發動作
  - 啟用：勾選
- [ ] 點擊「💾 儲存」
- [ ] 確認顯示「✅ 觸發動作已新增！」
- [ ] Modal 自動關閉
- [ ] 動作列表自動刷新

#### E3. 動作列表顯示
- [ ] 動作卡片顯示正常
- [ ] 動作名稱顯示正確
- [ ] 設備名稱顯示正確
- [ ] 觸發類型顯示正確（🚪 進入範圍）
- [ ] 推送訊息名稱顯示正確
- [ ] 說明顯示正確
- [ ] 狀態標籤顯示「✅ 啟用中」

#### E4. 測試不同觸發類型
- [ ] 新增「離開範圍」觸發動作
- [ ] 新增「停留範圍」觸發動作
- [ ] 確認圖示顯示正確（👋、⏱️）

### F. Tab 切換測試
- [ ] 在 3 個 Tab 之間來回切換
- [ ] 確認每次切換內容正確
- [ ] 確認 Tab 按鈕狀態正確更新
- [ ] 確認資料不會遺失

### G. 統計更新測試
- [ ] 新增設備後，「總設備數」立即更新
- [ ] 等待 30 秒，確認統計自動刷新
- [ ] 手動刷新頁面，確認統計正確

## 🔍 進階測試

### H. 資料關聯測試
- [ ] 新增觸發動作時，設備下拉選單顯示所有設備
- [ ] 新增觸發動作時，訊息下拉選單顯示所有訊息
- [ ] 動作列表正確顯示關聯的設備和訊息名稱

### I. 錯誤處理測試
- [ ] 網路斷線時顯示錯誤訊息
- [ ] 資料庫連線失敗時顯示錯誤訊息
- [ ] 表單驗證錯誤時顯示提示

### J. 效能測試
- [ ] 新增 10 個設備，確認列表載入速度
- [ ] 新增 10 個訊息，確認列表載入速度
- [ ] 新增 10 個動作，確認列表載入速度
- [ ] 確認頁面不會卡頓

## 📱 實際 Beacon 測試（需要實體設備）

### K. Webhook 接收測試
- [ ] 設定 LINE Bot Webhook URL
- [ ] 使用實體 Beacon 設備觸發
- [ ] 確認 `beacon_events` 表有記錄
- [ ] 確認 `is_friend` 欄位正確記錄

### L. 推送測試
- [ ] 觸發 Beacon 後收到推送訊息
- [ ] 已加入好友收到對應訊息
- [ ] 未加入好友收到對應訊息
- [ ] 訊息內容正確

## ✅ 測試結果

### 通過項目
- 記錄通過的測試項目

### 失敗項目
- 記錄失敗的測試項目
- 記錄錯誤訊息
- 記錄重現步驟

### 待修復問題
- 列出需要修復的問題
- 標註優先級

## 📝 測試備註

- 測試日期：
- 測試人員：
- 測試環境：
- 瀏覽器版本：
- 其他備註：

