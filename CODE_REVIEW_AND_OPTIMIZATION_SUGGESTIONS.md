# ğŸ“Š ä»£ç¢¼å¯©æŸ¥èˆ‡å„ªåŒ–å»ºè­°å ±å‘Š

**ç”Ÿæˆæ—¥æœŸ**: 2026å¹´1æœˆ1æ—¥  
**å°ˆæ¡ˆ**: Sticker Tycoon - LINE Bot AI è²¼åœ–ç”Ÿæˆç³»çµ±  
**ç‰ˆæœ¬**: 1.0

---

## ğŸ“‹ ç›®éŒ„

1. [ç¾ç‹€è©•ä¼°](#ç¾ç‹€è©•ä¼°)
2. [å·²å®Œæˆå„ªåŒ–](#å·²å®Œæˆå„ªåŒ–)
3. [æ–°å¢å„ªåŒ–å»ºè­°](#æ–°å¢å„ªåŒ–å»ºè­°)
4. [ä»£ç¢¼å“è³ªæ”¹é€²](#ä»£ç¢¼å“è³ªæ”¹é€²)
5. [æ¶æ§‹å„ªåŒ–æ©Ÿæœƒ](#æ¶æ§‹å„ªåŒ–æ©Ÿæœƒ)
6. [å®‰å…¨æ€§å¢å¼·](#å®‰å…¨æ€§å¢å¼·)
7. [ç›£æ§èˆ‡æ—¥èªŒ](#ç›£æ§èˆ‡æ—¥èªŒ)
8. [å„ªå…ˆç´šèˆ‡å¯¦æ–½è¨ˆåŠƒ](#å„ªå…ˆç´šèˆ‡å¯¦æ–½è¨ˆåŠƒ)

---

## ç¾ç‹€è©•ä¼°

### âœ… å°ˆæ¡ˆå„ªå‹¢

| é ˜åŸŸ | ç‹€æ…‹ | èªªæ˜ |
|------|------|------|
| **æ¡†æ¶é¸æ“‡** | âœ… å„ªç§€ | ä½¿ç”¨ Netlify Functions + Supabaseï¼Œè¼•é‡ç´šéƒ¨ç½² |
| **ä»£ç¢¼çµ„ç¹”** | âœ… è‰¯å¥½ | æ¨¡çµ„åŒ–è¨­è¨ˆï¼Œé—œæ³¨é»åˆ†é›¢æ˜ç¢º |
| **éŒ¯èª¤è™•ç†** | âœ… å·²å¯¦ç¾ | è‡ªå®šç¾©éŒ¯èª¤é¡ã€ç•°å¸¸æ•ç²æ©Ÿåˆ¶ |
| **å¿«å–ç­–ç•¥** | âœ… å·²å„ªåŒ– | ä½¿ç”¨å…¨å±€å¿«å–ç®¡ç†å™¨ï¼Œå¤šå±¤å¿«å–ç­–ç•¥ |
| **è³‡æ–™åº«å„ªåŒ–** | âœ… å·²å®Œæˆ | ç´¢å¼•å„ªåŒ–ã€JOIN æŸ¥è©¢ã€N+1 å•é¡Œè§£æ±º |
| **API è¨­è¨ˆ** | âœ… éµå¾ªæ¨™æº– | RESTful è¨­è¨ˆã€åˆç†çš„ HTTP ç‹€æ…‹ç¢¼ |

### âš ï¸ éœ€è¦æ”¹é€²çš„é ˜åŸŸ

| é ˜åŸŸ | å„ªå…ˆç´š | èªªæ˜ |
|------|--------|------|
| **å‹åˆ¥å®‰å…¨** | ğŸ”´ é«˜ | å¤§é‡ JavaScriptï¼Œç¼ºå°‘å‹åˆ¥æª¢æŸ¥ |
| **å–®å…ƒæ¸¬è©¦** | ğŸ”´ é«˜ | æ¸¬è©¦è¦†è“‹ç‡ä½æ–¼ 50%ï¼Œasync æµç¨‹ç„¡å®Œæ•´æ¸¬è©¦ |
| **è¼¸å…¥é©—è­‰** | ğŸŸ¡ ä¸­ | æŸäº› API ç«¯é»é©—è­‰ä¸å¤ å®Œæ•´ |
| **éåŒæ­¥æµç¨‹ç®¡ç†** | ğŸŸ¡ ä¸­ | Promise éˆå¼å‘¼å«ï¼Œéƒ¨åˆ†éŒ¯èª¤è™•ç†ä¸å®Œå–„ |
| **æ•ˆèƒ½ç›£æ§** | ğŸŸ¡ ä¸­ | ç¼ºå°‘å¯¦æ™‚æ€§èƒ½æŒ‡æ¨™æ”¶é›† |
| **ä»£ç¢¼è¤‡è£½** | ğŸŸ¡ ä¸­ | æŸäº›åŠŸèƒ½æœ‰é‡è¤‡å¯¦ç¾ |

---

## å·²å®Œæˆå„ªåŒ–

### 1. âœ… Prompt å„ªåŒ–ï¼ˆPrompt V8.0ï¼‰

**æ•ˆæœ**:
- Prompt é•·åº¦ï¼š2,520 â†’ 981 å­—å…ƒï¼ˆ**ç¯€çœ 61.1%**ï¼‰
- Token ä½¿ç”¨æ¸›å°‘ ~45%
- API æˆæœ¬ç¯€çœ ~45%

**æ”¹é€²æ–¹å‘**:
- åŸºç¤ Prompt ç²¾ç°¡ 59.7%
- absoluteRequirements ç²¾ç°¡ 83.3%
- DeepSeek å¢å¼·åŠŸèƒ½å¯é¸

**æ–‡ä»¶**: `FINAL_OPTIMIZATION_REPORT.md`

---

### 2. âœ… è³‡æ–™åº«æ€§èƒ½å„ªåŒ–

**å·²å®Œæˆ**:
- âœ… é—œéµè¡¨ç´¢å¼•æ·»åŠ ï¼ˆ10+ è¡¨ï¼‰
- âœ… å¿«å–æ™‚é–“å„ªåŒ–ï¼ˆ5åˆ†é˜ â†’ 30åˆ†é˜ï¼‰
- âœ… N+1 æŸ¥è©¢å•é¡Œä¿®å¾©
- âœ… JOIN æŸ¥è©¢ä½¿ç”¨

**é æœŸæ•ˆèƒ½æå‡**:
- API éŸ¿æ‡‰æ™‚é–“ -40%ï¼ˆ~500ms â†’ ~300msï¼‰
- è³‡æ–™åº«æŸ¥è©¢é€Ÿåº¦ -50%ï¼ˆ~200ms â†’ ~100msï¼‰
- å¿«å–å‘½ä¸­ç‡ +42%ï¼ˆ~60% â†’ ~85%ï¼‰
- è³‡æ–™åº«è² è¼‰ -30-50%

**æ–‡ä»¶**: `docs/PERFORMANCE_OPTIMIZATION.md`

---

### 3. âœ… UI ä¸»é¡Œç³»çµ±

**æ”¹é€²**:
- ç²‰ç´…ç³» â†’ ç¶ è‰²ç³»çµ±
- å°èˆªæ¬„å„ªåŒ–ï¼ˆ200px â†’ 60pxï¼‰
- Hero å€åŸŸé‡æ§‹ï¼ˆå±…ä¸­ â†’ å·¦å³åˆ†æ¬„ï¼‰

**æ–‡ä»¶**: `GREEN_THEME_CONVERSION_REPORT.md`

---

## æ–°å¢å„ªåŒ–å»ºè­°

### ğŸ”´ é«˜å„ªå…ˆç´š

#### 1. å¼•å…¥ TypeScript é€²è¡Œå‹åˆ¥æª¢æŸ¥

**ç¾ç‹€**: ç´” JavaScriptï¼Œç¼ºå°‘å‹åˆ¥æª¢æŸ¥
```javascript
// âŒ ç¾æ³ï¼šé›£ä»¥è¿½è¹¤å‹åˆ¥
async function getUserLatestTask(userId) {
  // userId å¯èƒ½æ˜¯ä»»ä½•å‹åˆ¥
  // è¿”å›å‹åˆ¥ä¸æ¸…æ¥š
}
```

**å»ºè­°æ–¹æ¡ˆ**:
```javascript
// âœ… ä½¿ç”¨ JSDoc å‹åˆ¥è¨»è§£ï¼ˆå¿«é€Ÿæ–¹æ¡ˆï¼‰
/**
 * @param {string} userId - LINE ç”¨æˆ¶ ID
 * @returns {Promise<{task_id: string, status: string}>}
 */
async function getUserLatestTask(userId) {
  // ...
}
```

**æ›´å¥½æ–¹æ¡ˆ**: é€æ­¥é·ç§»è‡³ TypeScript
```typescript
// å®Œæ•´æ–¹æ¡ˆï¼šTypeScript
interface GenerationTask {
  task_id: string;
  user_id: string;
  status: 'pending' | 'processing' | 'completed' | 'failed';
  progress: number;
}

async function getUserLatestTask(userId: string): Promise<GenerationTask | null> {
  // ...
}
```

**é æœŸæ•ˆèƒ½**:
- æ¸›å°‘ Bug ç‡ ~30-40%
- æé«˜ä»£ç¢¼å¯ç¶­è­·æ€§
- IDE è‡ªå‹•å®Œæˆæ›´ç²¾æº–

**å¯¦æ–½æ­¥é©Ÿ**:
1. æ·»åŠ  JSDoc è¨»è§£ï¼ˆ1-2å‘¨ï¼Œå¿«é€Ÿæ–¹æ¡ˆï¼‰
2. é…ç½® TypeScriptï¼ˆ2-4å‘¨ï¼Œå®Œæ•´æ–¹æ¡ˆï¼‰
3. é€æ­¥é·ç§»æ ¸å¿ƒæ¨¡å¡Šï¼ˆ4-8å‘¨ï¼‰

---

#### 2. å¢å¼·å–®å…ƒæ¸¬è©¦è¦†è“‹ç‡

**ç¾ç‹€**: è¦†è“‹ç‡ < 50%ï¼Œasync æµç¨‹ç¼ºä¹æ¸¬è©¦

**éœ€è¦æ¸¬è©¦çš„é—œéµè·¯å¾‘**:
```javascript
// 1. ç•°æ­¥æµç¨‹æ¸¬è©¦
- getUserLatestTask() æˆåŠŸ/å¤±æ•—
- generateStickersIntelligent() å„ç¨®æ¨¡å¼
- applyReferralCode() è¤‡é›œæ¥­å‹™é‚è¼¯

// 2. é‚Šç•Œæ¢ä»¶
- ç©ºçµæœã€nullã€undefined è™•ç†
- è¶…æ™‚ã€é‡è©¦æ©Ÿåˆ¶
- ä¸¦ç™¼è«‹æ±‚

// 3. éŒ¯èª¤æ¢å¾©
- è³‡æ–™åº«é€£æ¥å¤±æ•—
- API è¶…æ™‚
- ç„¡æ•ˆè¼¸å…¥
```

**å»ºè­°é…ç½®**:
```javascript
// jest.config.js å„ªåŒ–
module.exports = {
  coverageThreshold: {
    global: {
      branches: 70,      // å¾ 50 æå‡
      functions: 75,     // å¾ 50 æå‡
      lines: 75,         // å¾ 50 æå‡
      statements: 75     // å¾ 50 æå‡
    }
  },
  testMatch: [
    '**/functions/__tests__/**/*.test.js',
    '**/functions/services/**/*.test.js'  // æ–°å¢
  ]
};
```

**æ¸¬è©¦ç¯„ä¾‹**:
```javascript
// functions/__tests__/supabase-client.test.js
describe('getUserLatestTask', () => {
  it('should return latest task for valid user', async () => {
    const result = await getUserLatestTask('U123');
    expect(result).toBeDefined();
    expect(result.task_id).toBeDefined();
  });

  it('should return null when no tasks exist', async () => {
    const result = await getUserLatestTask('UNKNOWN_USER');
    expect(result).toBeNull();
  });

  it('should handle database errors gracefully', async () => {
    // Mock database error
    jest.spyOn(supabase, 'from').mockRejectedValueOnce(new Error('DB Error'));
    expect(async () => {
      await getUserLatestTask('U123');
    }).rejects.toThrow();
  });
});
```

**é æœŸæ”¶ç›Š**:
- ç™¼ç¾éš±è—çš„ Bug ~15-20%
- é‡æ§‹æ™‚æ›´æœ‰ä¿¡å¿ƒ
- è‡ªå‹•åŒ–å›æ­¸æ¸¬è©¦

**å¯¦æ–½æ™‚é–“**: 3-4 å‘¨

---

#### 3. è¼¸å…¥é©—è­‰èˆ‡æ•¸æ“šæ¸…ç†æ¨™æº–åŒ–

**ç¾ç‹€**: æŸäº› API ç«¯é»é©—è­‰ä¸å®Œæ•´
```javascript
// âŒ ä¸å®‰å…¨çš„é©—è­‰
exports.handler = async (event) => {
  const code = event.body.code;  // æ²’æœ‰é©—è­‰
  // ç›´æ¥ä½¿ç”¨ code
};
```

**å»ºè­°æ–¹æ¡ˆ**: çµ±ä¸€é©—è­‰å±¤
```javascript
// âœ… functions/middleware/input-validator.js
const { z } = require('zod');

const schemas = {
  referralCode: z.string().length(6).regex(/^[A-Z0-9]+$/),
  userId: z.string().regex(/^U[a-f0-9]{32}$/),
  stickerCount: z.number().int().min(1).max(40),
  style: z.enum(['realistic', 'cute', 'cool', 'funny', 'simple', 'anime', 'pixel', 'sketch'])
};

function validateInput(data, schema) {
  try {
    return schema.parse(data);
  } catch (error) {
    return { error: error.issues[0].message };
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const handler = async (event) => {
  const { code } = JSON.parse(event.body);
  const validated = validateInput({ code }, schemas.referralCode);
  
  if (validated.error) {
    return {
      statusCode: 400,
      body: JSON.stringify({ error: validated.error })
    };
  }
  
  // ç¹¼çºŒè™•ç†...
};
```

**æ¶µè“‹ç¯„åœ**:
- LINE Webhook è¨Šæ¯é©—è­‰
- Web API åƒæ•¸é©—è­‰
- æ¥­å‹™è¦å‰‡é©—è­‰ï¼ˆä»£å¹£é¤˜é¡ã€é…é¡ç­‰ï¼‰

**é æœŸæ”¶ç›Š**:
- é˜²æ­¢ç„¡æ•ˆæ•¸æ“šé€²å…¥ç³»çµ±
- æ¸›å°‘è³‡æ–™åº«æŸ¥è©¢
- æé«˜å®‰å…¨æ€§

---

### ğŸŸ¡ ä¸­å„ªå…ˆç´š

#### 4. æ”¹é€²ç•°æ­¥æµç¨‹ç®¡ç†

**ç¾ç‹€**: æ··åˆä½¿ç”¨ async/await å’Œ Promise éˆ
```javascript
// âŒ æ··åˆé¢¨æ ¼
getOrCreateUser(lineUserId)
  .then(user => {
    // éƒ¨åˆ†é‚è¼¯ç”¨ Promise
    return processUser(user).then(result => {
      // æ·±å±¤åµŒå¥—
      return uploadData(result);
    });
  })
  .catch(err => console.error(err));
```

**å»ºè­°æ–¹æ¡ˆ**: çµ±ä¸€ä½¿ç”¨ async/await
```javascript
// âœ… çµ±ä¸€çš„ async/await
async function handleUserCreation(lineUserId) {
  try {
    const user = await getOrCreateUser(lineUserId);
    const processed = await processUser(user);
    const uploaded = await uploadData(processed);
    return uploaded;
  } catch (error) {
    console.error('Failed to create user:', error);
    throw new AppError('ç”¨æˆ¶å»ºç«‹å¤±æ•—', 'USER_CREATION_ERROR');
  }
}
```

**ä¸¦ç™¼å„ªåŒ–**:
```javascript
// âŒ é †åºåŸ·è¡Œï¼ˆä½æ•ˆï¼‰
const style = await getStyleSettings(styleId);
const framing = await getFramingSettings(framingId);
const scene = await getSceneSettings(sceneId);

// âœ… ä¸¦ç™¼åŸ·è¡Œï¼ˆé«˜æ•ˆï¼‰
const [style, framing, scene] = await Promise.all([
  getStyleSettings(styleId),
  getFramingSettings(framingId),
  getSceneSettings(sceneId)
]);
```

**è¶…æ™‚ä¿è­·**:
```javascript
// âœ… æ·»åŠ è¶…æ™‚æ©Ÿåˆ¶
async function withTimeout(promise, timeoutMs) {
  return Promise.race([
    promise,
    new Promise((_, reject) => 
      setTimeout(() => reject(new Error('Operation timeout')), timeoutMs)
    )
  ]);
}

// ä½¿ç”¨
const result = await withTimeout(
  generateStickers(photo, style),
  60000  // 60 ç§’è¶…æ™‚
);
```

**é æœŸæ”¶ç›Š**:
- ä»£ç¢¼å¯è®€æ€§ +30%
- Bug æ¸›å°‘ ~15-20%
- æ€§èƒ½æ”¹å–„ +10-15%

---

#### 5. æé«˜ä»£ç¢¼è¤‡ç”¨æ€§

**ç¾ç‹€**: æŸäº›åŠŸèƒ½æœ‰é‡è¤‡å¯¦ç¾
```javascript
// âŒ åœ¨å¤šå€‹æ–‡ä»¶ä¸­é‡è¤‡
// line-webhook.js
function truncateText(text, maxLength) {
  return text.length > maxLength 
    ? text.substring(0, maxLength - 3) + '...' 
    : text;
}

// command-service.js
function truncateText(text, maxLength) {
  // ç›¸åŒå¯¦ç¾ï¼
}
```

**å»ºè­°æ–¹æ¡ˆ**: å‰µå»ºå…±äº«å·¥å…·åº«
```javascript
// âœ… functions/utils/string-utils.js
function truncateText(text, maxLength) {
  return text.length > maxLength 
    ? text.substring(0, maxLength - 3) + '...' 
    : text;
}

function sanitizeInput(input) {
  return input.trim().toLowerCase();
}

function formatTokenAmount(amount) {
  return amount.toLocaleString('zh-TW');
}

module.exports = {
  truncateText,
  sanitizeInput,
  formatTokenAmount
};

// åœ¨å„æ¨¡å¡Šä¸­ä½¿ç”¨
const { truncateText } = require('./utils/string-utils');
```

**å…±äº«çµ„ä»¶æ¸…å–®**:
```
functions/utils/
  â”œâ”€â”€ string-utils.js (å­—ä¸²è™•ç†)
  â”œâ”€â”€ date-utils.js (æ—¥æœŸè™•ç†)
  â”œâ”€â”€ file-utils.js (æ–‡ä»¶æ“ä½œ)
  â”œâ”€â”€ image-utils.js (åœ–ç‰‡è™•ç†)
  â”œâ”€â”€ validation-utils.js (é©—è­‰)
  â””â”€â”€ format-utils.js (æ ¼å¼åŒ–)
```

**é æœŸæ”¶ç›Š**:
- ä»£ç¢¼ç¶­è­·æ›´å®¹æ˜“
- Bug ä¿®å¾©æ›´å¿«é€Ÿ
- ä¸€è‡´çš„å¯¦ç¾

---

#### 6. å®Œå–„æ•ˆèƒ½ç›£æ§

**ç¾ç‹€**: ç¼ºå°‘å¯¦æ™‚æ€§èƒ½æŒ‡æ¨™
```javascript
// âŒ ç„¡ç³»çµ±çš„æ—¥èªŒ
console.log('é–‹å§‹ç”Ÿæˆ');
// ...
console.log('å®Œæˆ');
```

**å»ºè­°æ–¹æ¡ˆ**: çµæ§‹åŒ–ç›£æ§
```javascript
// âœ… functions/utils/performance-monitor.js
class PerformanceMonitor {
  constructor(operationName) {
    this.name = operationName;
    this.startTime = Date.now();
    this.metrics = {};
  }

  mark(label) {
    this.metrics[label] = Date.now() - this.startTime;
    console.log(`[${this.name}] ${label}: ${this.metrics[label]}ms`);
  }

  end() {
    const total = Date.now() - this.startTime;
    console.log(`[${this.name}] Total: ${total}ms`);
    return {
      name: this.name,
      metrics: this.metrics,
      total
    };
  }
}

// ä½¿ç”¨ç¤ºä¾‹
async function generateStickers(photo, style) {
  const monitor = new PerformanceMonitor('generateStickers');
  
  const processed = await processImage(photo);
  monitor.mark('image-processing');
  
  const generated = await callAI(processed, style);
  monitor.mark('ai-generation');
  
  const result = monitor.end();
  // ä¸Šå‚³åˆ°åˆ†ææœå‹™
  await logMetrics(result);
}
```

**ç›£æ§æŒ‡æ¨™**:
```
- API éŸ¿æ‡‰æ™‚é–“ï¼ˆç›®æ¨™ < 300msï¼‰
- è³‡æ–™åº«æŸ¥è©¢æ™‚é–“ï¼ˆç›®æ¨™ < 100msï¼‰
- å¿«å–å‘½ä¸­ç‡ï¼ˆç›®æ¨™ > 85%ï¼‰
- AI ç”Ÿæˆæ™‚é–“ï¼ˆç›®æ¨™ < 30sï¼‰
- éŒ¯èª¤ç‡ï¼ˆç›®æ¨™ < 0.1%ï¼‰
```

**é æœŸæ”¶ç›Š**:
- å¿«é€Ÿç™¼ç¾æ€§èƒ½ç“¶é ¸
- æ•¸æ“šé©…å‹•çš„å„ªåŒ–æ±ºç­–
- ç”Ÿç”¢ç’°å¢ƒç›£æ§

---

#### 7. å¢å¼·å®‰å…¨æ€§

**ç¾ç‹€æª¢æŸ¥æ¸…å–®**:
```javascript
// 1. ç’°å¢ƒè®Šæ•¸ä¿è­· âœ“ (å·²ä½¿ç”¨ .env)
// 2. å…¥åŠ›é©—è­‰ âš ï¸ (éœ€è¦åŠ å¼·)
// 3. CORS è¨­å®š âš ï¸ (æª¢æŸ¥ netlify.toml)
// 4. é€Ÿç‡é™åˆ¶ âŒ (ç¼ºå°‘)
// 5. SQL æ³¨å…¥é˜²è­· âœ“ (ä½¿ç”¨ Supabase)
// 6. Token éæœŸ âœ“ (å¯¦ç¾)
```

**å»ºè­°å¯¦æ–½**:

```javascript
// âœ… functions/middleware/rate-limiter.js
const rateLimitMap = new Map();

function getRateLimit(key, maxRequests = 100, windowMs = 60000) {
  const now = Date.now();
  let record = rateLimitMap.get(key);
  
  if (!record || now - record.resetTime > windowMs) {
    record = { count: 0, resetTime: now };
  }
  
  record.count++;
  rateLimitMap.set(key, record);
  
  if (record.count > maxRequests) {
    return false;  // è¶…éé™åˆ¶
  }
  
  return true;
}

// ä½¿ç”¨
const handler = async (event) => {
  const clientId = event.requestContext.identity.sourceIp;
  
  if (!getRateLimit(clientId, 100, 60000)) {
    return {
      statusCode: 429,
      body: JSON.stringify({ error: 'è«‹æ±‚éæ–¼é »ç¹ï¼Œè«‹ç¨å¾Œé‡è©¦' })
    };
  }
  
  // ç¹¼çºŒè™•ç†...
};
```

**CORS è¨­å®š**:
```javascript
// âœ… netlify.toml ä¸­æ·»åŠ 
[[headers]]
for = "/api/*"
[headers.values]
  Access-Control-Allow-Origin = "https://your-domain.com"
  Access-Control-Allow-Methods = "GET, POST, OPTIONS"
  Access-Control-Allow-Headers = "Content-Type, Authorization"
```

**å®‰å…¨é ­éƒ¨**:
```javascript
[[headers]]
for = "/*"
[headers.values]
  X-Content-Type-Options = "nosniff"
  X-Frame-Options = "DENY"
  X-XSS-Protection = "1; mode=block"
  Content-Security-Policy = "default-src 'self'"
```

---

### ğŸŸ¢ ä½å„ªå…ˆç´š

#### 8. å„ªåŒ–æ§‹å»ºèˆ‡éƒ¨ç½²æµç¨‹

**å»ºè­°**:
```javascript
// âœ… æ·»åŠ æ§‹å»ºæ­¥é©Ÿåˆ° package.json
{
  "scripts": {
    "build": "npm run lint && npm run test:coverage",
    "predeploy": "npm run build",
    "bundle-check": "size-limit"
  }
}
```

**Size Limit é…ç½®**:
```javascript
// .size-limits.js
export default [
  {
    path: 'functions/line-webhook.js',
    limit: '50 KB'
  },
  {
    path: 'functions/**/*.js',
    limit: '300 KB'
  }
];
```

---

#### 9. å®Œå–„æ–‡æª”

**éœ€è¦è£œå……çš„æ–‡æª”**:
```
docs/
  â”œâ”€â”€ ARCHITECTURE.md (æ¶æ§‹èªªæ˜)
  â”œâ”€â”€ API_REFERENCE.md (API æ–‡æª”)
  â”œâ”€â”€ DATABASE_SCHEMA.md (è³‡æ–™åº«è¨­è¨ˆ)
  â”œâ”€â”€ DEPLOYMENT_GUIDE.md (éƒ¨ç½²æŒ‡å—)
  â”œâ”€â”€ TROUBLESHOOTING.md (æ•…éšœæ’é™¤)
  â””â”€â”€ CONTRIBUTING.md (è²¢ç»æŒ‡å—)
```

---

#### 10. è¨­å®š CI/CD æµç¨‹

**GitHub Actions ç¤ºä¾‹**:
```yaml
# .github/workflows/test.yml
name: Test & Deploy

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '20'
      - run: npm ci
      - run: npm run lint
      - run: npm run test:coverage
      - run: npm run build

  deploy:
    if: github.ref == 'refs/heads/main'
    needs: test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - run: npm ci
      - run: npx netlify deploy --prod
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_TOKEN }}
```

---

## ä»£ç¢¼å“è³ªæ”¹é€²

### 1. ESLint é…ç½®å¢å¼·

**å»ºè­°è¦å‰‡è£œå……**:
```javascript
// eslint.config.js æ–°å¢
rules: {
  // é¡å¤–çš„åš´æ ¼è¦å‰‡
  'no-unhandled-promise-rejections': 'error',
  'require-await': 'error',
  'no-async-promise-executor': 'error',
  
  // è¤‡é›œåº¦æª¢æŸ¥
  'complexity': ['warn', 10],
  'max-depth': ['warn', 4],
  'max-nested-callbacks': ['warn', 3],
  
  // è¨»è§£è¦æ±‚
  'require-jsdoc': ['warn', {
    require: {
      FunctionDeclaration: true,
      MethodDefinition: true,
      ClassDeclaration: true
    }
  }]
}
```

### 2. Prettier é¢¨æ ¼çµ±ä¸€

å·²é…ç½® âœ…ï¼Œå»ºè­°æ·»åŠ  pre-commit hook:
```bash
# .husky/pre-commit
npm run lint:fix
npm run format
```

---

## æ¶æ§‹å„ªåŒ–æ©Ÿæœƒ

### 1. æ¨¡å¡ŠåŒ–é‡æ§‹

**ç¾æ³**: æŸäº›å‡½æ•¸æ–‡ä»¶éå¤§ï¼ˆe.g., line-webhook.js: 3300+ è¡Œï¼‰

**å»ºè­°**:
```
functions/
  â”œâ”€â”€ handlers/
  â”‚   â”œâ”€â”€ text-message-handler.js
  â”‚   â”œâ”€â”€ image-message-handler.js
  â”‚   â”œâ”€â”€ postback-handler.js
  â”‚   â””â”€â”€ follow-handler.js
  â”œâ”€â”€ services/
  â”‚   â”œâ”€â”€ sticker-service.js
  â”‚   â”œâ”€â”€ user-service.js
  â”‚   â”œâ”€â”€ referral-service.js
  â”‚   â””â”€â”€ token-service.js
  â”œâ”€â”€ middleware/
  â”‚   â”œâ”€â”€ auth.js
  â”‚   â”œâ”€â”€ validation.js
  â”‚   â”œâ”€â”€ rate-limit.js
  â”‚   â””â”€â”€ error-handler.js
  â””â”€â”€ line-webhook.js (ç°¡åŒ–çš„è·¯ç”±)
```

---

### 2. äº‹ä»¶é©…å‹•æ¶æ§‹

**è€ƒæ…®ä½¿ç”¨äº‹ä»¶ç™¼å°„å™¨**:
```javascript
// âœ… functions/utils/event-emitter.js
const EventEmitter = require('events');

class StickerEventEmitter extends EventEmitter {}
const emitter = new StickerEventEmitter();

// äº‹ä»¶å®šç¾©
emitter.on('sticker:generated', async (data) => {
  await uploadMetrics(data);
  await notifyUser(data);
});

emitter.on('tokens:deducted', async (data) => {
  await logTransaction(data);
  await updateBalance(data);
});

// ç™¼é€äº‹ä»¶
emitter.emit('sticker:generated', {
  userId: 'U123',
  count: 6,
  duration: 2500
});
```

---

## å®‰å…¨æ€§å¢å¼·

### 1. æ•æ„Ÿä¿¡æ¯ç®¡ç†

**å»ºè­°**:
```javascript
// âœ… functions/utils/secrets.js
const secretsCache = new Map();

async function getSecret(name) {
  if (secretsCache.has(name)) {
    return secretsCache.get(name);
  }
  
  // å¾ç’°å¢ƒè®Šæ•¸è®€å–ï¼ˆNetlify Secretsï¼‰
  const value = process.env[name];
  if (!value) {
    throw new Error(`Secret ${name} not found`);
  }
  
  // å¿«å– 1 å°æ™‚
  secretsCache.set(name, value);
  setTimeout(() => secretsCache.delete(name), 3600000);
  
  return value;
}
```

### 2. æ—¥èªŒå®‰å…¨

**æ•æ„Ÿä¿¡æ¯éæ¿¾**:
```javascript
// âœ… ä¸è¦è¨˜éŒ„
console.log('Token:', authToken);  // âŒ å±éšª
console.log('Password:', password); // âŒ å±éšª

// âœ… æ”¹ç‚º
console.log('Auth token masked:', authToken.slice(0, 10) + '***');
console.log('User authenticated successfully');
```

---

## ç›£æ§èˆ‡æ—¥èªŒ

### å»ºè­°çš„ç›£æ§æŒ‡æ¨™

| æŒ‡æ¨™ | ç›®æ¨™ | æª¢æŸ¥å·¥å…· |
|------|------|---------|
| API éŸ¿æ‡‰æ™‚é–“ | < 300ms | Netlify Analytics |
| éŒ¯èª¤ç‡ | < 0.1% | æ—¥èªŒèšåˆ |
| å¿«å–å‘½ä¸­ç‡ | > 85% | è‡ªå®šç¾©è¨ˆæ•¸å™¨ |
| AI ç”Ÿæˆæ™‚é–“ | < 30s | æ€§èƒ½ç›£æ§ |
| è³‡æ–™åº«é€£æ¥ | < 10 å€‹ | Supabase å„€è¡¨æ¿ |

### æ—¥èªŒèšåˆ

**å»ºè­°ä½¿ç”¨**:
- Netlify Analytics (å·²å…§ç½®)
- Sentry for éŒ¯èª¤è¿½è¹¤
- LogRocket ç”¨æˆ¶æœƒè©±å›æ”¾

---

## å„ªå…ˆç´šèˆ‡å¯¦æ–½è¨ˆåŠƒ

### ç¬¬ 1 éšæ®µï¼ˆ1-2 å‘¨ï¼‰- é—œéµä¿®å¾©
```
âœ… 1. è¼¸å…¥é©—è­‰æ¨™æº–åŒ–
âœ… 2. æ”¹é€²ç•°æ­¥æµç¨‹ç®¡ç†
âœ… 3. ä»£ç¢¼è¤‡ç”¨æ€§æå‡
é¢„è®¡æŠ•å…¥: 40-60 å°æ—¶
é¢„æœŸæ”¶ç›Š: Bug å‡å°‘ ~20%, ä»£ç è´¨é‡æå‡
```

### ç¬¬ 2 éšæ®µï¼ˆ2-4 å‘¨ï¼‰- è³ªé‡ä¿è­‰
```
âœ… 1. å¼•å…¥ JSDoc å‹åˆ¥è¨»è§£
âœ… 2. å¢å¼·å–®å…ƒæ¸¬è©¦è¦†è“‹ç‡ (70%+)
âœ… 3. å®Œå–„æ•ˆèƒ½ç›£æ§ç³»çµ±
é è¨ˆæŠ•å…¥: 60-100 å°æ™‚
é æœŸæ”¶ç›Š: é–‹ç™¼æ•ˆç‡ +20-30%, Bug ç‡ -30-40%
```

### ç¬¬ 3 éšæ®µï¼ˆ4-8 å‘¨ï¼‰- é•·æœŸå„ªåŒ–
```
âœ… 1. é·ç§»è‡³ TypeScriptï¼ˆå¯é¸ä½†æ¨è–¦ï¼‰
âœ… 2. æ¶æ§‹æ¨¡å¡ŠåŒ–é‡æ§‹
âœ… 3. å®‰å…¨æ€§åŠ å¼·
âœ… 4. CI/CD æµç¨‹å»ºç«‹
é è¨ˆæŠ•å…¥: 100-150 å°æ™‚
é æœŸæ”¶ç›Š: å¯ç¶­è­·æ€§å¤§å¹…æå‡, é–‹ç™¼é€Ÿåº¦åŠ å¿«
```

---

## å¿«é€Ÿè¡Œå‹•æ¸…å–®

### é€™é€±å¯åšçš„äº‹ (1-2 å¤©)
- [ ] æ·»åŠ  JSDoc å‹åˆ¥è¨»è§£åˆ°æ ¸å¿ƒå‡½æ•¸
- [ ] æå‡ ESLint è¦å‰‡åš´æ ¼åº¦
- [ ] æ·»åŠ è¼¸å…¥é©—è­‰å±¤åˆ° Web API

### æœ¬æœˆå¯åšçš„äº‹ (2-3 å‘¨)
- [ ] å¢å¼·å–®å…ƒæ¸¬è©¦è¦†è“‹ç‡è‡³ 70%
- [ ] å¯¦ç¾æ€§èƒ½ç›£æ§ç³»çµ±
- [ ] çµ±ä¸€ç•°æ­¥æµç¨‹ç®¡ç†

### å­£åº¦ç›®æ¨™ (2-3 æœˆ)
- [ ] é·ç§»è‡³ TypeScript (æˆ–è‡³å°‘å®Œæ•´ JSDoc)
- [ ] æ¨¡å¡ŠåŒ–é‡æ§‹å¤§å‹æ–‡ä»¶
- [ ] å»ºç«‹ CI/CD æµç¨‹

---

## æˆåŠŸæŒ‡æ¨™

åœ¨å¯¦æ–½é€™äº›å„ªåŒ–å¾Œï¼Œæ‡‰è©²çœ‹åˆ°ï¼š

| æŒ‡æ¨™ | ç›®å‰ | ç›®æ¨™ | æ”¶ç›Š |
|------|------|------|------|
| æ¸¬è©¦è¦†è“‹ç‡ | 50% | 75% | æ›´å°‘çš„ Bug |
| API éŸ¿æ‡‰æ™‚é–“ | ~500ms | ~300ms | ç”¨æˆ¶é«”é©—æ”¹å–„ |
| Bug ç™¼ç¾æ™‚é–“ | ç”Ÿç”¢ç’°å¢ƒ | é–‹ç™¼/æ¸¬è©¦ | é™ä½é¢¨éšª |
| ä»£ç¢¼è¤‡è£½ç‡ | ~15% | < 5% | ç¶­è­·æ›´å®¹æ˜“ |
| å¿«å–å‘½ä¸­ç‡ | ~60% | > 85% | æ€§èƒ½æ›´å¥½ |
| æ–°åŠŸèƒ½é–‹ç™¼æ™‚é–“ | 3-4 å‘¨ | 2-3 å‘¨ | äº¤ä»˜æ›´å¿« |

---

## ç¸½çµ

**æ•´é«”è©•ä¼°**: â­â­â­â­â˜† (4/5 åˆ†)

### å„ªå‹¢
âœ… æ¶æ§‹æ¸…æ™°ï¼Œæ¨¡å¡ŠåŒ–è¨­è¨ˆ  
âœ… å·²å¯¦æ–½é‡è¦çš„æ€§èƒ½å„ªåŒ–  
âœ… éŒ¯èª¤è™•ç†æ©Ÿåˆ¶å®Œæ•´  
âœ… éƒ¨ç½²æµç¨‹ç°¡åŒ–  

### æ”¹é€²ç©ºé–“
ğŸ”„ å‹åˆ¥å®‰å…¨æ€§æå‡  
ğŸ”„ æ¸¬è©¦è¦†è“‹ç‡å¢åŠ   
ğŸ”„ ä»£ç¢¼è¤‡ç”¨æ€§å„ªåŒ–  
ğŸ”„ ç›£æ§ç³»çµ±å®Œå–„  

### å»ºè­°å„ªå…ˆé—œæ³¨
1ï¸âƒ£ **è¼¸å…¥é©—è­‰** - å®‰å…¨æ€§æœ€é«˜  
2ï¸âƒ£ **æ¸¬è©¦è¦†è“‹** - é•·æœŸæ”¶ç›Šæœ€å¤§  
3ï¸âƒ£ **å‹åˆ¥æª¢æŸ¥** - é–‹ç™¼æ•ˆç‡æœ€é«˜  

---

**æ–‡ä»¶ç‰ˆæœ¬**: 1.0  
**æœ€å¾Œæ›´æ–°**: 2026-01-01  
**ä¸‹ä¸€æ­¥**: è¨è«–å„ªå…ˆç´šä¸¦é–‹å§‹å¯¦æ–½ç¬¬ 1 éšæ®µ

