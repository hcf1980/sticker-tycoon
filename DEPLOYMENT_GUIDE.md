# 白斑問題修復 - 快速部署指南

## [object Object] 分鐘快速部署

### 步驟 1: 備份 (1 分鐘)
```bash
# 備份原文件 (可選)
cp functions/grid-generator.js functions/grid-generator.js.backup
```

### 步驟 2: 驗證修改 (1 分鐘)
```bash
# 查看修改內容
git diff functions/grid-generator.js

# 或查看特定行
sed -n '464,513p' functions/grid-generator.js
```

### 步驟 3: 部署 (1 分鐘)
```bash
# 上傳修改後的文件到服務器
# 無需重新配置，無需重啟服務
```

### 步驟 4: 驗證 (2 分鐘)
```bash
# 查看日誌輸出
tail -f logs/sticker-generation.log

# 應該看到:
# 🔍 邊緣背景檢測：X/Y 點為背景色（比例：Z%）
```

## 📋 部署檢查清單

### 部署前
- [ ] 閱讀 EXECUTIVE_SUMMARY.md
- [ ] 備份原文件
- [ ] 確認修改內容

### 部署中
- [ ] 上傳修改後的文件
- [ ] 驗證文件完整性
- [ ] 確認無錯誤

### 部署後
- [ ] 監控日誌輸出
- [ ] 生成測試貼圖
- [ ] 檢查修復效果

## 🧪 測試驗證

### 測試 1: 眼白保留
```
輸入: 包含清晰眼白的照片
預期: 眼白被保留，不出現白斑
檢查: 查看生成的貼圖
```

### 測試 2: 牙齒保留
```
輸入: 包含可見牙齒的照片
預期: 牙齒被保留，不出現白斑
檢查: 查看生成的貼圖
```

### 測試 3: 棋盤格移除
```
輸入: 包含棋盤格背景的圖片
預期: 棋盤格背景完全移除
檢查: 查看生成的貼圖
```

## 📊 日誌監控

### 查看關鍵日誌
```
🔍 邊緣背景檢測：X/Y 點為背景色（比例：Z%）
⏭️ 邊緣非背景色（< 80%），跳過去背
🧹 執行智能去背（從邊緣開始）...
```

### 日誌說明
- 採樣點數應 > 8 (新增)
- 背景色比例應顯示百分比 (新增)
- 觸發條件應為 < 80% (修改)

## ⚙️ 配置說明

### 無需修改配置
- ✅ 無新的環境變數
- ✅ 無新的依賴項
- ✅ 無新的配置文件

### 直接部署
修改已完成，可直接部署，無需額外配置。

## 🔄 回滾方案

### 如果需要回滾
```bash
# 恢復備份
cp functions/grid-generator.js.backup functions/grid-generator.js

# 或使用 git
git checkout functions/grid-generator.js
```

## 📞 故障排除

### 問題 1: 白斑仍然出現
- 檢查日誌輸出
- 確認採樣點數 > 8
- 確認觸發條件為 < 80%

### 問題 2: 背景未移除
- 檢查是否為棋盤格背景
- 檢查背景顏色是否為 #CCCCCC 或 #999999
- 檢查背景色比例

### 問題 3: 邊緣被誤刪
- 檢查邊緣顏色是否 > 250
- 檢查是否為特殊顏色
- 查看詳細日誌

## 📚 相關文檔

- EXECUTIVE_SUMMARY.md - 執行摘要
- QUICK_REFERENCE.md - 快速參考
- CODE_COMPARISON.md - 代碼對比
- VERIFICATION_REPORT.md - 驗證報告

## ✨ 總結

修改已完成，可直接部署。預期改進：
- ✅ 眼白保留
- ✅ 牙齒保留
- ✅ 衣服亮部保留
- ✅ 頭髮邊緣清晰

---

**部署時間**: 5 分鐘
**風險等級**: 低
**回滾難度**: 簡單

