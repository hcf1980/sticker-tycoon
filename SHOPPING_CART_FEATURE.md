# 購物車結帳功能說明

## 📋 功能概述

已成功實現購物車狀態和結帳流程，用戶現在需要點擊「結帳」按鈕才會看到付款資訊。

## 🔄 用戶流程

### 步驟 1: 查看方案
用戶輸入「購買張數」後，會看到兩個方案卡片：

**NT$ 300 方案**
- 💰 價格：NT$ 300
- 🎫 張數：140 張
- 💵 每張約：$2.1
- 🛒 結帳按鈕

**NT$ 500 方案** （🔥 最熱門）
- 💰 價格：NT$ 500
- 🎫 張數：260 張
- 💵 每張約：$1.9
- 🛒 結帳按鈕

### 步驟 2: 點擊結帳
用戶點擊任一方案的「🛒 結帳」按鈕後，會收到：

1. **付款資訊卡片**
   - 顯示已選擇的方案（價格和張數）
   - 銀行轉帳資訊：
     - 銀行：連線商業銀行（824）
     - 帳號：111000196474
     - 戶名：梁勝喜
   - 付款步驟說明
   - 重要提示

2. **QR Code 圖片**
   - 轉帳 QR Code 圖片
   - 快速回覆選項

## 💻 技術實現

### 修改的文件
- `functions/line-webhook.js`

### 新增功能

#### 1. `handlePurchaseInfo()` - 顯示方案選擇
```javascript
// 只返回方案輪播，每個方案都有「結帳」按鈕
return getLineClient().replyMessage(replyToken, planCarousel);
```

#### 2. `handleCheckout(replyToken, price)` - 處理結帳
```javascript
// 驗證價格並顯示付款資訊
// 包含銀行轉帳資訊和 QR Code
```

### 消息處理

#### 觸發「結帳」流程
```javascript
// 新版：由結帳按鈕觸發
if (text.startsWith('結帳:')) {
  const price = Number(text.replace('結帳:', '').trim());
  return await handleCheckout(replyToken, price);
}

// 舊版：向後兼容
if (text.startsWith('購買方案:')) {
  const price = Number(text.replace('購買方案:', '').trim());
  return await handleCheckout(replyToken, price);
}
```

## 🎨 UI 設計

### 方案卡片
- **藍色**：NT$ 300 方案
- **紅色**：NT$ 500 方案（標記為「🔥 最熱門」）
- 每個卡片包含：
  - 價格標題
  - 張數顯示
  - 每張單價
  - 結帳按鈕

### 付款資訊卡片
- **綠色標題**：顯示已選方案
- **灰色區塊**：銀行轉帳資訊
- **黃色區塊**：付款步驟
- **紅色提示**：轉帳備註提醒

## 📱 用戶體驗優化

1. **清晰的購物流程**
   - 先選擇方案
   - 再查看付款方式
   - 減少資訊過載

2. **視覺引導**
   - 使用顏色區分方案
   - 標記熱門方案
   - 清楚的按鈕標籤

3. **快速回覆選項**
   - YouTuber 推廣計畫
   - 我的貼圖
   - 創建貼圖
   - 購買張數
   - 分享給好友

## ✅ 測試建議

### 測試案例

1. **正常流程測試**
   ```
   用戶: 購買張數
   機器人: [顯示兩個方案卡片]
   用戶: [點擊 NT$ 300 的結帳按鈕]
   機器人: [顯示付款資訊 + QR Code]
   ```

2. **方案切換測試**
   ```
   用戶: 購買張數
   機器人: [顯示兩個方案卡片]
   用戶: [點擊 NT$ 500 的結帳按鈕]
   機器人: [顯示付款資訊，標題顯示 NT$ 500（260張）]
   ```

3. **向後兼容測試**
   ```
   用戶: 購買方案:300
   機器人: [顯示付款資訊 + QR Code]
   ```

## 🚀 部署

修改已完成，可以直接部署到生產環境：

```bash
git add functions/line-webhook.js SHOPPING_CART_FEATURE.md
git commit -m "feat: 實現購物車結帳流程 - 添加結帳按鈕，優化購買體驗"
git push
```

## 📝 注意事項

1. **環境變數**：確保 `process.env.URL` 已正確設定
2. **圖片資源**：確認 `payment-qr.png` 圖片存在且可訪問
3. **向後兼容**：保留了舊的「購買方案:」命令格式

## 🎯 未來改進建議

1. 添加購物車狀態管理（記錄用戶選擇的方案）
2. 實現 LINE Pay 整合
3. 添加訂單追蹤功能
4. 自動化對帳流程

