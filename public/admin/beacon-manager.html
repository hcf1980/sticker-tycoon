<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LINE Beacon ç®¡ç†</title>

  <!-- Netlify Identity Widget -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="/tech-theme.css" rel="stylesheet">
  <style>
    input,textarea,select{background:rgba(30,41,59,0.9)!important;border:1px solid rgba(99,179,237,0.3)!important;color:#fff!important;padding:12px!important;border-radius:8px!important;width:100%!important}
    input:focus,textarea:focus,select:focus{border-color:#63b3ed!important;box-shadow:0 0 0 3px rgba(99,179,237,0.2)!important}
    input::placeholder,textarea::placeholder{color:rgba(255,255,255,0.4)!important}
  </style>
</head>
<body class="tech-bg min-h-screen text-white">
  <nav class="border-b border-gray-700 bg-gray-900/50">
    <div class="container mx-auto px-4 py-4 flex justify-between">
      <h1 class="text-xl font-bold">ğŸ“¡ LINE Beacon ç®¡ç†</h1>
      <div class="flex gap-4">
        <a href="/admin/index.html" class="text-cyan-400 hover:text-cyan-300">â† è¿”å›</a>
        <button id="logoutBtn" class="text-red-400 hover:text-red-300">ç™»å‡º</button>
      </div>
    </div>
  </nav>
  
  <div class="container mx-auto p-6">
    <!-- çµ±è¨ˆå„€è¡¨æ¿ -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
      <div class="bg-gradient-to-br from-cyan-500/20 to-blue-500/20 border border-cyan-500/30 rounded-lg p-4">
        <div class="text-sm text-gray-400 mb-1">ç¸½è¨­å‚™æ•¸</div>
        <div class="text-3xl font-bold text-white" id="totalDevices">0</div>
      </div>
      <div class="bg-gradient-to-br from-green-500/20 to-emerald-500/20 border border-green-500/30 rounded-lg p-4">
        <div class="text-sm text-gray-400 mb-1">ä»Šæ—¥è§¸ç™¼æ¬¡æ•¸</div>
        <div class="text-3xl font-bold text-white" id="todayTriggers">0</div>
      </div>
      <div class="bg-gradient-to-br from-purple-500/20 to-pink-500/20 border border-purple-500/30 rounded-lg p-4">
        <div class="text-sm text-gray-400 mb-1">å·²åŠ å…¥å¥½å‹æ¨é€</div>
        <div class="text-3xl font-bold text-white" id="friendPushes">0</div>
      </div>
      <div class="bg-gradient-to-br from-orange-500/20 to-red-500/20 border border-orange-500/30 rounded-lg p-4">
        <div class="text-sm text-gray-400 mb-1">æœªåŠ å…¥å¥½å‹æ¨é€</div>
        <div class="text-3xl font-bold text-white" id="nonFriendPushes">0</div>
      </div>
    </div>

    <!-- Tab åˆ‡æ› -->
    <div class="flex gap-4 mb-6 border-b border-gray-700">
      <button class="tab-btn active px-4 py-2 text-cyan-400 border-b-2 border-cyan-400" data-tab="devices">ğŸ“¡ è¨­å‚™ç®¡ç†</button>
      <button class="tab-btn px-4 py-2 text-gray-400 hover:text-cyan-400" data-tab="actions">âš¡ è§¸ç™¼å‹•ä½œ</button>
      <button class="tab-btn px-4 py-2 text-gray-400 hover:text-cyan-400" data-tab="messages">ğŸ’¬ æ¨é€è¨Šæ¯</button>
    </div>

    <!-- è¨­å‚™ç®¡ç† Tab -->
    <div id="devicesTab" class="tab-content">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold">è¨­å‚™åˆ—è¡¨</h2>
        <button id="addBeaconBtn" class="bg-cyan-600 hover:bg-cyan-700 px-6 py-2 rounded-lg">â• æ–°å¢è¨­å‚™</button>
      </div>
      <div id="devicesContainer" class="space-y-4"></div>
    </div>

    <!-- è§¸ç™¼å‹•ä½œ Tab -->
    <div id="actionsTab" class="tab-content hidden">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold">è§¸ç™¼å‹•ä½œè¨­å®š</h2>
        <button id="addActionBtn" class="bg-cyan-600 hover:bg-cyan-700 px-6 py-2 rounded-lg">â• æ–°å¢å‹•ä½œ</button>
      </div>
      <div id="actionsContainer" class="space-y-4"></div>
    </div>

    <!-- æ¨é€è¨Šæ¯ Tab -->
    <div id="messagesTab" class="tab-content hidden">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold">æ¨é€è¨Šæ¯æ¨¡æ¿</h2>
        <button id="addMessageBtn" class="bg-cyan-600 hover:bg-cyan-700 px-6 py-2 rounded-lg">â• æ–°å¢æ¨¡æ¿</button>
      </div>
      <div id="messagesContainer" class="space-y-4"></div>
    </div>
  </div>

  <!-- è¨­å‚™ Modal -->
  <div id="deviceModal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50">
    <div class="bg-gray-900 border border-cyan-500/30 rounded-xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
      <h3 id="modalTitle" class="text-xl font-bold mb-4">æ–°å¢ Beacon è¨­å‚™</h3>
      <form id="deviceForm" class="space-y-4">
        <div>
          <label class="block text-sm mb-2">è¨­å‚™åç¨± <span class="text-red-500">*</span></label>
          <input type="text" name="device_name" required placeholder="ä¾‹ï¼šè¾¦å…¬å®¤å…¥å£ Beacon">
        </div>
        <div>
          <label class="block text-sm mb-2">HWID (Hardware ID) <span class="text-red-500">*</span></label>
          <input type="text" name="hwid" required placeholder="10ä½16é€²åˆ¶å­—å…ƒ" pattern="[0-9a-fA-F]{10}" maxlength="10">
          <small class="text-gray-400">å¿…é ˆæ˜¯ 10 ä½ 16 é€²åˆ¶å­—å…ƒ</small>
        </div>
        <div>
          <label class="block text-sm mb-2">Vendor Key</label>
          <input type="text" name="vendor_key" placeholder="8ä½16é€²åˆ¶å­—å…ƒ" pattern="[0-9a-fA-F]{8}" maxlength="8">
        </div>
        <div>
          <label class="block text-sm mb-2">Lot Key</label>
          <input type="text" name="lot_key" placeholder="16ä½16é€²åˆ¶å­—å…ƒ" pattern="[0-9a-fA-F]{16}" maxlength="16">
        </div>
        <div>
          <label class="block text-sm mb-2">ä½ç½®</label>
          <input type="text" name="location" placeholder="ä¾‹ï¼šå°åŒ—è¾¦å…¬å®¤ä¸€æ¨“">
        </div>
        <div>
          <label class="block text-sm mb-2">èªªæ˜</label>
          <textarea name="description" rows="3" placeholder="è¨­å‚™èªªæ˜..."></textarea>
        </div>
        <div class="flex items-center gap-2">
          <input type="checkbox" name="is_active" checked id="is_active">
          <label for="is_active">å•Ÿç”¨æ­¤è¨­å‚™</label>
        </div>
        <div class="flex gap-3 pt-4">
          <button type="submit" class="bg-cyan-600 hover:bg-cyan-700 px-6 py-2 rounded-lg flex-1">ğŸ’¾ å„²å­˜</button>
          <button type="button" class="close-modal bg-gray-700 hover:bg-gray-600 px-6 py-2 rounded-lg">âœ• å–æ¶ˆ</button>
        </div>
      </form>
    </div>
  </div>

  <!-- è§¸ç™¼å‹•ä½œ Modal -->
  <div id="actionModal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50">
    <div class="bg-gray-900 border border-cyan-500/30 rounded-xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
      <h3 class="text-xl font-bold mb-4">æ–°å¢è§¸ç™¼å‹•ä½œ</h3>
      <form id="actionForm" class="space-y-4">
        <div>
          <label class="block text-sm mb-2">å‹•ä½œåç¨± <span class="text-red-500">*</span></label>
          <input type="text" name="action_name" required placeholder="ä¾‹ï¼šæ­¡è¿è¨Šæ¯">
        </div>
        <div>
          <label class="block text-sm mb-2">é¸æ“‡è¨­å‚™ <span class="text-red-500">*</span></label>
          <select name="hwid" required id="actionDeviceSelect">
            <option value="">è«‹é¸æ“‡è¨­å‚™</option>
          </select>
        </div>
        <div>
          <label class="block text-sm mb-2">è§¸ç™¼é¡å‹ <span class="text-red-500">*</span></label>
          <select name="trigger_type" required>
            <option value="enter">é€²å…¥ç¯„åœ (Enter)</option>
            <option value="leave">é›¢é–‹ç¯„åœ (Leave)</option>
            <option value="stay">åœç•™ç¯„åœ (Stay)</option>
          </select>
        </div>
        <div>
          <label class="block text-sm mb-2">é¸æ“‡æ¨é€è¨Šæ¯ <span class="text-red-500">*</span></label>
          <select name="message_id" required id="actionMessageSelect">
            <option value="">è«‹é¸æ“‡è¨Šæ¯æ¨¡æ¿</option>
          </select>
        </div>
        <div>
          <label class="block text-sm mb-2">èªªæ˜</label>
          <textarea name="description" rows="3" placeholder="å‹•ä½œèªªæ˜..."></textarea>
        </div>
        <div class="flex items-center gap-2">
          <input type="checkbox" name="is_active" checked id="action_is_active">
          <label for="action_is_active">å•Ÿç”¨æ­¤å‹•ä½œ</label>
        </div>
        <div class="flex gap-3 pt-4">
          <button type="submit" class="bg-cyan-600 hover:bg-cyan-700 px-6 py-2 rounded-lg flex-1">ğŸ’¾ å„²å­˜</button>
          <button type="button" class="close-modal bg-gray-700 hover:bg-gray-600 px-6 py-2 rounded-lg">âœ• å–æ¶ˆ</button>
        </div>
      </form>
    </div>
  </div>

  <!-- æ¨é€è¨Šæ¯ Modal -->
  <div id="messageModal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50">
    <div class="bg-gray-900 border border-cyan-500/30 rounded-xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
      <h3 class="text-xl font-bold mb-4">æ–°å¢æ¨é€è¨Šæ¯æ¨¡æ¿</h3>
      <form id="messageForm" class="space-y-4">
        <div>
          <label class="block text-sm mb-2">æ¨¡æ¿åç¨± <span class="text-red-500">*</span></label>
          <input type="text" name="template_name" required placeholder="ä¾‹ï¼šæ­¡è¿è¨Šæ¯">
        </div>
        <div>
          <label class="block text-sm mb-2">è¨Šæ¯é¡å‹ <span class="text-red-500">*</span></label>
          <select name="message_type" required>
            <option value="text">ç´”æ–‡å­—è¨Šæ¯</option>
            <option value="flex">Flex Message (å¡ç‰‡)</option>
            <option value="image">åœ–ç‰‡è¨Šæ¯</option>
          </select>
        </div>
        <div>
          <label class="block text-sm mb-2">è¨Šæ¯å…§å®¹ <span class="text-red-500">*</span></label>
          <textarea name="message_content" required rows="6" placeholder="è¼¸å…¥è¨Šæ¯å…§å®¹æˆ– JSON..."></textarea>
          <small class="text-gray-400">ç´”æ–‡å­—ç›´æ¥è¼¸å…¥ï¼ŒFlex Message è«‹è¼¸å…¥ JSON æ ¼å¼</small>
        </div>
        <div>
          <label class="block text-sm mb-2">ç›®æ¨™å°è±¡</label>
          <select name="target_audience">
            <option value="all">æ‰€æœ‰ç”¨æˆ¶</option>
            <option value="friends">å·²åŠ å…¥å¥½å‹</option>
            <option value="non_friends">æœªåŠ å…¥å¥½å‹</option>
          </select>
        </div>
        <div>
          <label class="block text-sm mb-2">èªªæ˜</label>
          <textarea name="description" rows="2" placeholder="æ¨¡æ¿èªªæ˜..."></textarea>
        </div>
        <div class="flex items-center gap-2">
          <input type="checkbox" name="is_active" checked id="message_is_active">
          <label for="message_is_active">å•Ÿç”¨æ­¤æ¨¡æ¿</label>
        </div>
        <div class="flex gap-3 pt-4">
          <button type="submit" class="bg-cyan-600 hover:bg-cyan-700 px-6 py-2 rounded-lg flex-1">ğŸ’¾ å„²å­˜</button>
          <button type="button" class="close-modal bg-gray-700 hover:bg-gray-600 px-6 py-2 rounded-lg">âœ• å–æ¶ˆ</button>
        </div>
      </form>
    </div>
  </div>

  <script src="/admin/beacon-manager-simple.js"></script>
</body>
</html>
