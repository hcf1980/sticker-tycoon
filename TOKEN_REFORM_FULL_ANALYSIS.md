# 📊 代幣制度改革 - 完整分析報告

## 🎯 執行可行性評估

### ✅ 結論：**完全可執行**

基於以下理由：
1. ✅ **技術可行**：無需停機，可熱更新
2. ✅ **數據安全**：1:1 轉換，無遺失風險
3. ✅ **工作量適中**：約 20 個檔案，3-5 天完成
4. ✅ **用戶影響小**：餘額不變，僅名稱改變

---

## 📋 改革詳細內容

### 1️⃣ 商品定價變更

| 項目 | 舊制度 | 新制度 | 變更說明 |
|------|--------|--------|----------|
| **新用戶贈送** | 40 代幣 | 40 張 | 1:1 對應 |
| **基礎包** | 70 代幣<br/>NT$ 300 | 140 張<br/>NT$ 300 | 數量 × 2<br/>單價 4.29→2.14 元 |
| **超值包** | 130 代幣<br/>NT$ 500 | 260 張<br/>NT$ 500 | 數量 × 2<br/>單價 3.85→1.92 元 |

### 2️⃣ 消耗規則變更

#### 生成服務
| 生成張數 | 舊制度消耗 | 新制度消耗 | 邏輯 |
|---------|-----------|-----------|------|
| 6 張 | 3 代幣 | **6 張** | 1:1 對應 |
| 12 張 | 6 代幣 | **12 張** | 1:1 對應 |
| 18 張 | 9 代幣 | **18 張** | 1:1 對應 |
| 40 張 | 20 代幣 | **40 張** | 1:1 對應 |

#### 附加服務
| 服務 | 舊制度 | 新制度 | 變更原因 |
|------|--------|--------|----------|
| **下載服務** | 40 代幣 | **60 張** | 調高以反映成本 |
| **代上架服務** | 40 代幣 | **20 張** | 調低以鼓勵使用 |

### 3️⃣ 推薦獎勵
- 推薦人：10 張（不變）
- 被推薦人：10 張（不變）
- 上限：30 次（不變）

---

## 💻 技術實施細節

### 核心邏輯變更

#### 變更 1: 生成扣除計算
**檔案**：`functions/sticker-generator-worker-background.js`

```javascript
// ❌ 舊邏輯（複雜）
const apiCalls = Math.ceil(stickerCount / 6);  // 6張為一批
const tokenCost = apiCalls * 3;  // 每批3代幣
// 例：6張 = 1批 × 3 = 3代幣
//    12張 = 2批 × 3 = 6代幣

// ✅ 新邏輯（簡單直觀）
const tokenCost = stickerCount;  // 直接等於張數
// 例：6張 = 6張數
//    12張 = 12張數
```

#### 變更 2: 下載費用
**檔案**：`functions/pack-for-line.js`

```javascript
// ❌ 舊
const DOWNLOAD_COST = 40;

// ✅ 新
const DOWNLOAD_COST = 60;
```

#### 變更 3: 配置更新
**檔案**：`functions/grid-generator.js`

```javascript
// ❌ 舊配置
const GRID_CONFIG = {
  tokensPerBatch: 3,
  packages: {
    basic: { stickers: 6, tokens: 3, apiCalls: 1 },
    standard: { stickers: 12, tokens: 6, apiCalls: 2 }
  }
};

// ✅ 新配置
const GRID_CONFIG = {
  tokensPerBatch: 6,  // 改為 6
  packages: {
    basic: { stickers: 6, tokens: 6, apiCalls: 1 },     // 3→6
    standard: { stickers: 12, tokens: 12, apiCalls: 2 }  // 6→12
  }
};
```

---

## 📂 需修改檔案總覽

### P0 級別（核心邏輯）- 必須修改
1. `functions/supabase-client.js` ⭐⭐⭐
2. `functions/sticker-generator-worker-background.js` ⭐⭐⭐
3. `functions/pack-for-line.js` ⭐⭐⭐
4. `functions/grid-generator.js` ⭐⭐
5. `functions/services/user-service.js` ⭐⭐

### P1 級別（使用者介面）- 必須修改
6. `public/token-guide.html` ⭐⭐
7. `public/token-guide-mobile.html` ⭐⭐
8. `public/queue.html` ⭐⭐
9. `public/index.html` ⭐
10. `public/admin/index.html` ⭐

### P2 級別（LINE Bot）- 必須修改
11. `functions/services/command-service.js` ⭐⭐
12. `functions/handlers/create-handler.js` ⭐⭐

### P3 級別（文檔）- 建議修改
13. `README.md` ⭐
14. `docs/TOKEN_SYSTEM_STATUS.md` ⭐
15. `docs/api/LINE_PAY_INTEGRATION_GUIDE.md` ⭐
16-20. 其他文檔檔案

---

## ⏱️ 時間估算

| 階段 | 工作內容 | 預估時間 |
|------|---------|---------|
| **準備** | 備份資料庫、環境檢查 | 0.5 天 |
| **資料庫** | 執行遷移 SQL | 0.5 天 |
| **核心邏輯** | 修改 5 個核心檔案 | 1.5 天 |
| **使用者介面** | 修改 5 個 HTML 檔案 | 1 天 |
| **LINE Bot** | 修改 2 個訊息檔案 | 0.5 天 |
| **文檔** | 更新所有文檔 | 0.5 天 |
| **測試** | 完整功能測試 | 1 天 |
| **部署** | 上線與監控 | 0.5 天 |
| **總計** | | **3-5 天** |

---

## 🎯 優勢分析

### 用戶體驗改善
| 方面 | 舊制度問題 | 新制度優勢 |
|------|-----------|-----------|
| **理解難度** | 代幣與張數轉換不直觀 | 1張=1張，極易理解 |
| **價值感知** | 70代幣感覺少 | 140張感覺更划算 |
| **消費透明** | 需計算「6張=3代幣」 | 直接「6張=6張」 |
| **心理門檻** | 「代幣」有虛擬貨幣感 | 「張數」更實在 |

### 營運效益
1. ✅ **降低客服成本**：減少定價諮詢
2. ✅ **提升轉換率**：更清晰的價值主張
3. ✅ **易於推廣**：「300元140張」比「300元70代幣」更吸引人
4. ✅ **擴展性強**：未來推出新方案更靈活

---

## ⚠️ 風險管理

| 風險 | 等級 | 發生機率 | 影響範圍 | 應對措施 |
|------|------|---------|---------|---------|
| 用戶混淆舊稱 | 🟡 中 | 30% | 客服壓力 | 發送系統通知 |
| 程式邏輯錯誤 | 🟡 中 | 20% | 扣除不正確 | 充分測試 |
| 資料不一致 | 🟢 低 | 5% | 餘額錯誤 | 驗證查詢 |
| 停機時間 | 🟢 低 | 0% | - | 熱更新無需停機 |

---

## 📊 用戶影響評估

### 現有用戶
- ✅ **餘額不變**：40 代幣 → 40 張（數值相同）
- ✅ **購買力相同**：實際可生成的貼圖數量不變
- ⚠️ **需適應新名稱**：從「代幣」改為「張數」

### 新用戶
- ✅ **更易理解**：無需學習「代幣」概念
- ✅ **價值感更強**：「140 張」比「70 代幣」更吸引人

---

## ✅ 最終建議

### 🟢 **強烈建議執行此改革**

**核心理由**：
1. **大幅提升用戶體驗**：從複雜的代幣轉換變為直觀的1:1對應
2. **技術風險極低**：僅改文案和簡單邏輯，無資料遷移風險
3. **長期收益顯著**：降低客服成本、提升轉換率

**最佳執行時機**：
- ✅ 週末或低峰時段
- ✅ 準備好回滾方案
- ✅ 先小範圍測試（10% 用戶）

---

## 📞 後續支援

已準備完整文檔套件：
1. ✅ 執行方案 - `TOKEN_REFORM_PLAN.md`
2. ✅ 檔案清單 - `TOKEN_REFORM_FILE_LIST.md`
3. ✅ 測試清單 - `TOKEN_REFORM_TEST_CHECKLIST.md`
4. ✅ 快速開始 - `TOKEN_REFORM_QUICK_START.md`
5. ✅ 資料庫遷移 - `migrations/token_reform_2025.sql`
6. ✅ 遷移腳本 - `scripts/migrate-token-to-stickers.sh`

**隨時可開始執行！** 🚀

