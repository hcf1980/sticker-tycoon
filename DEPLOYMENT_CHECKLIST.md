# ğŸš€ éƒ¨ç½²æª¢æŸ¥æ¸…å–®

## æ€§èƒ½å„ªåŒ–éƒ¨ç½²å‰æª¢æŸ¥

### âœ… ç¨‹å¼ç¢¼æª¢æŸ¥

- [x] æ‰€æœ‰æ–°æª”æ¡ˆå·²å»ºç«‹
  - [x] `functions/utils/cache-manager.js`
  - [x] `functions/utils/profile-updater.js`
  - [x] `functions/utils/performance-monitor.js`
  - [x] `functions/performance-stats.js`
  - [x] `functions/test-performance.js`

- [x] ç¾æœ‰æª”æ¡ˆå·²æ›´æ–°
  - [x] `functions/supabase-client.js` - åŠ å…¥å¿«å–
  - [x] `functions/conversation-state.js` - åŠ å…¥å¿«å–
  - [x] `functions/line-webhook.js` - ä¸¦è¡Œè™•ç† + éåŒæ­¥ Profile

- [x] ç„¡èªæ³•éŒ¯èª¤
- [x] æ¸¬è©¦é€šé

### ğŸ“ ç’°å¢ƒè®Šæ•¸æª¢æŸ¥

ç¢ºä¿ä»¥ä¸‹ç’°å¢ƒè®Šæ•¸å·²è¨­å®šï¼š

```bash
# Netlify ç’°å¢ƒè®Šæ•¸
SUPABASE_URL=your_supabase_url
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
LINE_CHANNEL_ACCESS_TOKEN=your_line_token
LINE_CHANNEL_SECRET=your_line_secret

# æ–°å¢ï¼šæ€§èƒ½çµ±è¨ˆ API æˆæ¬Šï¼ˆå¯é¸ï¼‰
ADMIN_TOKEN=your_secret_admin_token
```

### ğŸ§ª æ¸¬è©¦æ­¥é©Ÿ

#### 1. æœ¬åœ°æ¸¬è©¦

```bash
# æ¸¬è©¦å¿«å–å’Œæ€§èƒ½ç›£æ§
cd functions
node test-performance.js

# é æœŸçµæœï¼š
# âœ… æ‰€æœ‰æ¸¬è©¦å®Œæˆ
# ğŸ“Š å¿«å–æå‡: 90%
```

#### 2. åŠŸèƒ½æ¸¬è©¦

æ¸¬è©¦ä»¥ä¸‹ LINE Bot åŠŸèƒ½ï¼š

- [ ] ç™¼é€æ–‡å­—è¨Šæ¯ â†’ æ”¶åˆ°å›è¦†
- [ ] æŸ¥è©¢ã€Œæˆ‘çš„è²¼åœ–ã€â†’ æ­£å¸¸é¡¯ç¤º
- [ ] æŸ¥è©¢ã€Œä»£å¹£ã€â†’ æ­£å¸¸é¡¯ç¤º
- [ ] å‰µå»ºè²¼åœ–æµç¨‹ â†’ æ­£å¸¸é‹ä½œ
- [ ] æŸ¥è©¢é€²åº¦ â†’ æ­£å¸¸é¡¯ç¤º

#### 3. æ€§èƒ½æ¸¬è©¦

```bash
# æ¸¬è©¦å›è¦†é€Ÿåº¦ï¼ˆéœ€è¦éƒ¨ç½²å¾Œï¼‰
time curl -X POST https://your-webhook-url \
  -H "Content-Type: application/json" \
  -d '{"events":[{"type":"message","message":{"type":"text","text":"æ¸¬è©¦"}}]}'

# é æœŸï¼š< 500ms
```

### ğŸ“Š éƒ¨ç½²å¾Œé©—è­‰

#### 1. æª¢æŸ¥æ—¥èªŒ

```bash
# Netlify CLI
netlify functions:log line-webhook

# æŸ¥æ‰¾ä»¥ä¸‹æ—¥èªŒï¼š
# â±ï¸ [event_message_xxx] XXXms
# ğŸ§¹ æ¸…ç†éæœŸå¿«å–: X é …
```

#### 2. æŸ¥çœ‹æ€§èƒ½çµ±è¨ˆ

```bash
curl -H "Authorization: Bearer YOUR_ADMIN_TOKEN" \
  https://your-domain.netlify.app/.netlify/functions/performance-stats
```

é æœŸçµæœï¼š
```json
{
  "cache": {
    "size": 50,
    "maxSize": 1000,
    "usage": "5.0%"
  },
  "performance": {
    "event_message_xxx": {
      "avg": 300,
      "p95": 500
    }
  }
}
```

#### 3. ç›£æ§æŒ‡æ¨™

è§€å¯Ÿä»¥ä¸‹æŒ‡æ¨™ï¼ˆ24 å°æ™‚ï¼‰ï¼š

- [ ] å¹³å‡å›è¦†æ™‚é–“ < 500ms
- [ ] P95 å›è¦†æ™‚é–“ < 1000ms
- [ ] éŒ¯èª¤ç‡ < 1%
- [ ] å¿«å–å‘½ä¸­ç‡ > 70%

### ğŸ”„ å›æ»¾è¨ˆç•«

å¦‚æœå‡ºç¾å•é¡Œï¼š

#### æ–¹æ¡ˆ 1: åœç”¨å¿«å–

åœ¨ `functions/supabase-client.js` é–‹é ­åŠ å…¥ï¼š
```javascript
const DISABLE_CACHE = process.env.DISABLE_CACHE === 'true';
```

ç„¶å¾Œåœ¨ Netlify è¨­å®šç’°å¢ƒè®Šæ•¸ï¼š
```
DISABLE_CACHE=true
```

#### æ–¹æ¡ˆ 2: Git å›æ»¾

```bash
# å›æ»¾åˆ°å„ªåŒ–å‰çš„ç‰ˆæœ¬
git revert HEAD
git push
```

#### æ–¹æ¡ˆ 3: Netlify å›æ»¾

åœ¨ Netlify Dashboard:
1. é€²å…¥ Deploys
2. é¸æ“‡ä¸Šä¸€å€‹ç©©å®šç‰ˆæœ¬
3. é»æ“Š "Publish deploy"

### ğŸ“ˆ æ•ˆèƒ½åŸºæº–

è¨˜éŒ„å„ªåŒ–å‰å¾Œçš„æ•¸æ“šï¼š

#### å„ªåŒ–å‰ï¼ˆåŸºæº–ï¼‰
- å¹³å‡å›è¦†æ™‚é–“: _____ ms
- P95 å›è¦†æ™‚é–“: _____ ms
- è³‡æ–™åº«æŸ¥è©¢æ¬¡æ•¸/åˆ†é˜: _____
- éŒ¯èª¤ç‡: _____ %

#### å„ªåŒ–å¾Œï¼ˆç›®æ¨™ï¼‰
- å¹³å‡å›è¦†æ™‚é–“: < 500ms
- P95 å›è¦†æ™‚é–“: < 1000ms
- è³‡æ–™åº«æŸ¥è©¢æ¬¡æ•¸/åˆ†é˜: æ¸›å°‘ 60%
- éŒ¯èª¤ç‡: < 1%

### ğŸ› å¸¸è¦‹å•é¡Œ

#### å•é¡Œ 1: å¿«å–ä¸ç”Ÿæ•ˆ

**ç—‡ç‹€**: æ€§èƒ½æ²’æœ‰æå‡
**æª¢æŸ¥**:
```javascript
console.log(globalCache.getStats());
// å¦‚æœ size ä¸€ç›´æ˜¯ 0ï¼Œè¡¨ç¤ºå¿«å–æ²’æœ‰é‹ä½œ
```

**è§£æ±º**:
- æª¢æŸ¥æ˜¯å¦æœ‰èªæ³•éŒ¯èª¤
- ç¢ºèª require è·¯å¾‘æ­£ç¢º
- æŸ¥çœ‹ Netlify æ—¥èªŒ

#### å•é¡Œ 2: è³‡æ–™ä¸ä¸€è‡´

**ç—‡ç‹€**: é¡¯ç¤ºèˆŠè³‡æ–™
**è§£æ±º**:
```javascript
// æ‰‹å‹•æ¸…é™¤å¿«å–
globalCache.clear();
```

#### å•é¡Œ 3: è¨˜æ†¶é«”ä½¿ç”¨éé«˜

**ç—‡ç‹€**: Function timeout
**è§£æ±º**:
- é™ä½å¿«å–å®¹é‡ä¸Šé™
- ç¸®çŸ­ TTL
- æª¢æŸ¥æ˜¯å¦æœ‰è¨˜æ†¶é«”æ´©æ¼

### ğŸ“ ç·Šæ€¥è¯çµ¡

å¦‚æœé‡åˆ°åš´é‡å•é¡Œï¼š

1. ç«‹å³å›æ»¾åˆ°ç©©å®šç‰ˆæœ¬
2. æª¢æŸ¥ Netlify æ—¥èªŒ
3. æŸ¥çœ‹ Supabase æ—¥èªŒ
4. æª¢æŸ¥ LINE Bot ç‹€æ…‹

### âœ… éƒ¨ç½²å®Œæˆç¢ºèª

- [ ] æ‰€æœ‰æ¸¬è©¦é€šé
- [ ] æ€§èƒ½çµ±è¨ˆæ­£å¸¸
- [ ] ç„¡éŒ¯èª¤æ—¥èªŒ
- [ ] ç”¨æˆ¶å›å ±æ­£å¸¸
- [ ] ç›£æ§æŒ‡æ¨™é”æ¨™

---

## ğŸ‰ éƒ¨ç½²æˆåŠŸï¼

æ­å–œï¼LINE Bot æ€§èƒ½å·²å„ªåŒ–å®Œæˆã€‚

è¨˜å¾—ï¼š
- å®šæœŸæª¢æŸ¥æ€§èƒ½çµ±è¨ˆ
- ç›£æ§éŒ¯èª¤ç‡
- æ”¶é›†ç”¨æˆ¶åé¥‹
- æŒçºŒå„ªåŒ–

---

**éƒ¨ç½²æ—¥æœŸ**: _______________
**éƒ¨ç½²äººå“¡**: _______________
**ç‰ˆæœ¬è™Ÿ**: _______________

