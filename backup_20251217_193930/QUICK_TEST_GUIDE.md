# å¿«é€Ÿæ¸¬è©¦æŒ‡å—ï¼šä¸‹è¼‰åŠŸèƒ½ä¿®å¾©

## ğŸš€ ç«‹å³æ¸¬è©¦

### æ­¥é©Ÿ 1ï¼šæ›´æ–°è³‡æ–™åº«
åœ¨ Supabase SQL Editor åŸ·è¡Œï¼š

```sql
ALTER TABLE listing_applications 
ADD COLUMN IF NOT EXISTS zip_cache_url TEXT;

ALTER TABLE listing_applications 
ADD COLUMN IF NOT EXISTS zip_generating BOOLEAN DEFAULT FALSE;
```

### æ­¥é©Ÿ 2ï¼šæ‰“é–‹ç®¡ç†å¾Œå°
```
https://sticker-tycoon.netlify.app/admin/listing-manager
```

### æ­¥é©Ÿ 3ï¼šæ¸¬è©¦ä¸‹è¼‰
1. é»æ“Šä»»ä¸€ç”³è«‹è¨˜éŒ„
2. é»æ“Šã€ŒğŸ“¥ ä¸‹è¼‰è²¼åœ–å£“ç¸®åŒ…ã€æŒ‰éˆ•
3. è§€å¯ŸæŒ‰éˆ•è®ŠåŒ–ï¼š

```
â³ æº–å‚™ä¸­...
   â†“
ğŸ”„ ç”Ÿæˆä¸­ (2s)...
   â†“
ğŸ”„ ç”Ÿæˆä¸­ (5s)...
   â†“
ğŸ”„ ç”Ÿæˆä¸­ (10s)...
   â†“
âœ… ä¸‹è¼‰é–‹å§‹ï¼
```

### æ­¥é©Ÿ 4ï¼šé©—è­‰å¿«å–
**å†æ¬¡é»æ“ŠåŒä¸€å€‹ç”³è«‹çš„ä¸‹è¼‰æŒ‰éˆ•**ï¼Œæ‡‰è©²ï¼š
- âœ… ç«‹å³ä¸‹è¼‰ï¼ˆä¸å†é¡¯ç¤ºç”Ÿæˆä¸­ï¼‰
- âœ… ä¸éœ€è¦ç­‰å¾…

## ğŸ” èª¿è©¦æŠ€å·§

### æ‰“é–‹ç€è¦½å™¨æ§åˆ¶å°ï¼ˆF12ï¼‰
æŸ¥çœ‹ Console æ—¥èªŒï¼š

```javascript
// æˆåŠŸçš„æ—¥èªŒç¯„ä¾‹
é–‹å§‹ä¸‹è¼‰ç”³è«‹ STMJ3EWON0 çš„è²¼åœ–åŒ…...
å›æ‡‰ç‹€æ…‹: 200 OK
Content-Type: application/json
âœ… API å›æ‡‰: {success: true, ready: false, generating: true, message: "æ­£åœ¨ç”Ÿæˆä¸‹è¼‰æª”æ¡ˆï¼Œè«‹ç¨å€™..."}
â³ æ­£åœ¨ç”Ÿæˆä¸­ï¼Œç¹¼çºŒç­‰å¾…...
âœ… ZIP å·²ç”Ÿæˆ: https://...supabase.co/.../stickers.zip
```

### æª¢æŸ¥ Network è«‹æ±‚

1. **ç¬¬ä¸€æ¬¡ä¸‹è¼‰**ï¼š
   - `POST admin-listing` (downloadPack) â†’ ç«‹å³è¿”å›
   - `GET admin-listing?action=checkZip` â†’ æ¯ 2 ç§’è¼ªè©¢
   - æœ€å¾Œä¸€æ¬¡ checkZip è¿”å› `ready: true` + ä¸‹è¼‰é€£çµ

2. **ç¬¬äºŒæ¬¡ä¸‹è¼‰**ï¼š
   - `POST admin-listing` (downloadPack) â†’ ç›´æ¥è¿”å›ä¸‹è¼‰é€£çµ
   - ä¸å†æœ‰ checkZip è«‹æ±‚

## âš ï¸ å¸¸è¦‹å•é¡Œ

### å•é¡Œ 1ï¼šé‚„æ˜¯å‡ºç¾ 504 éŒ¯èª¤
**åŸå› **ï¼šè³‡æ–™åº«æ¬„ä½å°šæœªæ·»åŠ   
**è§£æ±º**ï¼šåŸ·è¡Œæ­¥é©Ÿ 1 çš„ SQL

### å•é¡Œ 2ï¼šä¸€ç›´é¡¯ç¤ºã€Œç”Ÿæˆä¸­ã€
**åŸå› **ï¼šå¾Œç«¯ç”Ÿæˆå¤±æ•—ï¼Œä½†æ¨™è¨˜æœªæ¸…é™¤  
**è§£æ±º**ï¼šåœ¨ Supabase æ‰‹å‹•æ¸…é™¤ï¼š
```sql
UPDATE listing_applications 
SET zip_generating = false 
WHERE application_id = 'ä½ çš„ç”³è«‹ç·¨è™Ÿ';
```

### å•é¡Œ 3ï¼šä¸‹è¼‰é€£çµæ‰“ä¸é–‹
**åŸå› **ï¼šSupabase Storage æ¬Šé™å•é¡Œ  
**è§£æ±º**ï¼šæª¢æŸ¥ Storage Policies

### å•é¡Œ 4ï¼šè¶…é 5 åˆ†é˜æ²’å®Œæˆ
**åŸå› **ï¼šè²¼åœ–æ•¸é‡éå¤šæˆ–ç¶²çµ¡æ…¢  
**å»ºè­°**ï¼š
1. åˆ·æ–°é é¢é‡è©¦
2. æª¢æŸ¥ Netlify Functions æ—¥èªŒ
3. æª¢æŸ¥ Supabase Storage é…é¡

## ğŸ“Š é æœŸçµæœ

| æ¸¬è©¦é …ç›® | é æœŸçµæœ | é€šé |
|---------|---------|------|
| ç¬¬ä¸€æ¬¡ä¸‹è¼‰ï¼ˆç„¡å¿«å–ï¼‰ | é¡¯ç¤ºé€²åº¦ï¼Œ30-60ç§’å¾Œä¸‹è¼‰ | â˜ |
| ç¬¬äºŒæ¬¡ä¸‹è¼‰ï¼ˆæœ‰å¿«å–ï¼‰ | ç«‹å³ä¸‹è¼‰ | â˜ |
| ä½µç™¼ä¸‹è¼‰å¤šå€‹ç”³è«‹ | äº’ä¸å¹²æ“¾ | â˜ |
| ç”Ÿæˆå¤±æ•—é‡è©¦ | å¯ä»¥é‡æ–°ä¸‹è¼‰ | â˜ |
| è¶…æ™‚æç¤º | 5åˆ†é˜å¾Œé¡¯ç¤ºéŒ¯èª¤ | â˜ |

## ğŸ¯ æˆåŠŸæ¨™æº–

âœ… ä¸å†å‡ºç¾ 504 Gateway Timeout éŒ¯èª¤  
âœ… ç”¨æˆ¶å¯ä»¥çœ‹åˆ°å¯¦æ™‚é€²åº¦ï¼ˆç§’æ•¸ï¼‰  
âœ… ç¬¬äºŒæ¬¡ä¸‹è¼‰é€Ÿåº¦æ˜é¡¯è®Šå¿«  
âœ… ä¸‹è¼‰çš„ ZIP åŒ…å«ï¼š
   - `main.png` (ä¸»åœ–)
   - `tab.png` (æ¨™ç±¤åœ–)
   - `01.png ~ 40.png` (è²¼åœ–)
   - `README.txt` (èªªæ˜)

## ğŸ”— ç›¸é—œé€£çµ

- Netlify éƒ¨ç½²: https://app.netlify.com/sites/sticker-tycoon/deploys
- Supabase Dashboard: https://supabase.com/dashboard/project/...
- GitHub Repo: https://github.com/hcf1980/sticker-tycoon

