# 🎯 代幣制度改革 - 執行摘要

## 📌 改革目標

將「代幣（tokens）」概念改為「張數（stickers/sheets）」，使計價更直觀易懂。

---

## ✅ 可行性評估結論

### 🟢 **此改革方案完全可執行**

**理由：**
1. ✅ 技術上可行，無需停機維護
2. ✅ 用戶數據無需遷移（1:1 直接對應）
3. ✅ 僅需修改約 20 個檔案
4. ✅ 無資料遺失風險
5. ✅ 預估完成時間：3-5 個工作天

---

## 💰 新舊制度對比

| 項目 | 舊制度 | 新制度 | 說明 |
|------|--------|--------|------|
| **單位名稱** | 代幣 (tokens) | 張數 (stickers) | 更直觀 |
| **新用戶贈送** | 40 代幣 | 40 張 | 1:1 轉換 |
| **基礎包** | 70 代幣 / NT$ 300 | 140 張 / NT$ 300 | 2x 倍數 |
| **超值包** | 130 代幣 / NT$ 500 | 260 張 / NT$ 500 | 2x 倍數 |
| **生成 6 張** | 3 代幣 | 6 張 | 1:1 對應 |
| **生成 12 張** | 6 代幣 | 12 張 | 1:1 對應 |
| **下載服務** | 40 代幣 | 60 張 | 調整為 60 |
| **代上架服務** | 40 代幣 | 20 張 | 調整為 20 |
| **推薦獎勵** | 10 代幣 | 10 張 | 保持不變 |

---

## 🔄 用戶數據轉換策略

### 策略：直接 1:1 對應（無需遷移）

```
舊用戶代幣數 → 新張數
40 代幣 → 40 張
70 代幣 → 70 張
130 代幣 → 130 張
```

**優勢：**
- 🎯 無需執行任何 UPDATE 語句
- 🎯 用戶餘額數值不變
- 🎯 僅改變語義和顯示文案
- 🎯 零停機時間

---

## 📂 需要修改的檔案

### 核心邏輯檔案（5 個）
1. ✅ `functions/supabase-client.js` - 張數扣除邏輯
2. ✅ `functions/sticker-generator-worker-background.js` - 生成扣除計算
3. ✅ `functions/pack-for-line.js` - 下載服務費用（40→60）
4. ✅ `functions/grid-generator.js` - 配置更新
5. ✅ `functions/services/user-service.js` - 用戶服務

### 使用者介面檔案（5 個）
6. ✅ `public/token-guide.html` - 購買說明頁
7. ✅ `public/token-guide-mobile.html` - 手機版購買說明
8. ✅ `public/queue.html` - 佇列管理頁
9. ✅ `public/index.html` - 首頁
10. ✅ `public/admin/index.html` - 管理後台

### LINE Bot 訊息（2 個）
11. ✅ `functions/services/command-service.js` - 查詢命令
12. ✅ `functions/handlers/create-handler.js` - 生成流程

### 文檔檔案（8 個）
13. ✅ `README.md`
14. ✅ `docs/TOKEN_SYSTEM_STATUS.md`
15. ✅ `docs/api/LINE_PAY_INTEGRATION_GUIDE.md`
16. ✅ 其他相關文檔

---

## 🛠️ 實施步驟

### Phase 1: 資料庫遷移（半天）
1. 執行 `migrations/token_reform_2025.sql`
2. 更新資料庫註解（僅註解，不改數值）
3. 驗證資料完整性

### Phase 2: 程式碼修改（2 天）
1. 修改核心邏輯（5 個檔案）
2. 更新使用者介面（5 個檔案）
3. 更新 LINE Bot 訊息（2 個檔案）
4. 執行單元測試

### Phase 3: 文檔更新（半天）
1. 更新 README.md
2. 更新所有相關文檔

### Phase 4: 測試與部署（1-2 天）
1. 在測試環境完整測試
2. 執行 `TOKEN_REFORM_TEST_CHECKLIST.md`
3. 部署到生產環境
4. 監控錯誤日誌

---

## 📊 關鍵變更摘要

### 計價邏輯變更

#### 生成服務
```javascript
// 舊邏輯
const apiCalls = Math.ceil(stickerCount / 6);
const tokenCost = apiCalls * 3;  // 6張=3代幣, 12張=6代幣

// 新邏輯
const tokenCost = stickerCount;  // 6張=6張數, 12張=12張數
```

#### 下載服務
```javascript
// 舊
const DOWNLOAD_COST = 40;  // 40 代幣

// 新
const DOWNLOAD_COST = 60;  // 60 張
```

#### 代上架服務
```javascript
// 舊
const LISTING_COST = 40;  // 40 代幣

// 新
const LISTING_COST = 20;  // 20 張
```

---

## ⚠️ 風險評估

| 風險 | 等級 | 應對措施 |
|------|------|---------|
| 用戶混淆新舊名稱 | 🟡 中 | 發送系統通知說明變更 |
| 程式邏輯錯誤 | 🟡 中 | 充分測試，灰度發布 |
| 資料不一致 | 🟢 低 | 執行驗證查詢確認 |
| 停機時間 | 🟢 低 | 無需停機（熱更新） |

---

## 📈 預期效益

### 用戶體驗改善
- ✅ **直觀明確**：1 張 = 1 張貼圖，容易理解
- ✅ **透明消費**：清楚知道每次消耗多少
- ✅ **降低門檻**：新用戶更容易理解定價

### 營運優勢
- ✅ **降低客服成本**：減少定價相關諮詢
- ✅ **提升轉換率**：更清晰的價值主張
- ✅ **易於推廣**：「300 元買 140 張」比「300 元買 70 代幣」更吸引人

---

## 📋 已準備的文件

1. ✅ **執行方案**：`TOKEN_REFORM_PLAN.md`
2. ✅ **檔案清單**：`TOKEN_REFORM_FILE_LIST.md`
3. ✅ **測試檢查清單**：`TOKEN_REFORM_TEST_CHECKLIST.md`
4. ✅ **資料庫遷移**：`migrations/token_reform_2025.sql`
5. ✅ **遷移腳本**：`scripts/migrate-token-to-stickers.sh`

---

## 🚀 建議執行時間

**最佳時間點：** 週末或低峰時段（減少對用戶影響）

**完整時程：**
- 準備階段：半天
- 開發測試：2-3 天
- 部署上線：半天
- 監控穩定：1 天

**總計：3-5 個工作天**

---

## ✅ 最終建議

### 🟢 **建議執行此改革**

**原因：**
1. 大幅提升用戶體驗（更直觀）
2. 技術實施風險低（1:1 轉換）
3. 無需停機維護（零影響）
4. 長期降低營運成本

**執行順序：**
1. 先執行資料庫遷移（更新註解）
2. 在測試環境完整測試
3. 灰度發布（先 10% 用戶，再全量）
4. 監控 1-2 天確保穩定

---

## 📞 聯絡方式

如有任何問題，請聯絡開發團隊。

